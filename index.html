<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Roleta de PrÃªmios Aprimorada</title>
  <style>
    body { 
      text-align: center; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: white;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    h1 { 
      margin-top: 0;
      font-size: 2.5rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .input-group {
      margin: 20px 0;
    }
    
    input {
      padding: 12px 20px;
      font-size: 18px;
      border: none;
      border-radius: 50px;
      width: 300px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    button {
      background: #FF5722;
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(255, 87, 34, 0.4);
      margin: 20px 0;
    }
    
    button:hover {
      background: #FF7043;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 87, 34, 0.6);
    }
    
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    #resultado {
      font-weight: bold;
      margin-top: 30px;
      font-size: 22px;
      background: rgba(255, 255, 255, 0.2);
      padding: 15px;
      border-radius: 10px;
      display: inline-block;
      min-width: 300px;
    }
    
    .roleta-container {
      position: relative;
      width: 400px;
      height: 400px;
      margin: 0 auto;
    }
    
    canvas {
      background: #fff;
      border-radius: 50%;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.4);
      transition: transform 0.1s;
    }
    
    .pointer {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 30px solid transparent;
      border-right: 30px solid transparent;
      border-bottom: 50px solid #FF5722;
      z-index: 10;
      filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.3));
    }
    
    .timer {
      font-size: 24px;
      margin: 15px 0;
      font-weight: bold;
    }
    
    .probabilidades {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    
    .probabilidade-item {
      background: rgba(255, 255, 255, 0.2);
      padding: 10px 20px;
      border-radius: 50px;
      font-weight: bold;
    }
    
    .vencedores {
      margin-top: 30px;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 15px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .vencedores h3 {
      margin-top: 0;
    }
    
    .vencedores-list {
      text-align: left;
      list-style-type: none;
      padding: 0;
    }
    
    .vencedores-list li {
      padding: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ¡ Roleta de PrÃªmios Premium</h1>
    
    <div class="input-group">
      <input id="nick" placeholder="Digite seu nick" autocomplete="off">
    </div>
    
    <button id="girar-btn" onclick="girar()">Girar Roleta!</button>
    
    <div class="timer" id="timer">Tempo restante: 10s</div>
    
    <div class="roleta-container">
      <div class="pointer"></div>
      <canvas id="roleta" width="400" height="400"></canvas>
    </div>
    
    <p id="resultado"></p>
    
    <div class="probabilidades">
      <div class="probabilidade-item" style="color: #FFD700;">Skin rara: 5%</div>
      <div class="probabilidade-item" style="color: #87CEEB;">100 moedas: 15%</div>
      <div class="probabilidade-item" style="color: #FF6347;">Nada ðŸ˜¢: 80%</div>
    </div>
    
    <div class="vencedores">
      <h3>Ãšltimos vencedores</h3>
      <ul class="vencedores-list" id="vencedores-list"></ul>
    </div>
  </div>

  <script>
    // === SUA API DO GOOGLE APPS SCRIPT ===
    const API_URL = "https://script.google.com/macros/s/AKfycbz_qOsdx0avjQZ0Hg6ktnTeYknYAb3x-nmdnHvwVZ0K0KVZSk6QSxuQkMoi2KdPX8wNuQ/exec";

    // === CONFIGURAÃ‡ÃƒO DOS PRÃŠMIOS ===
    // Percentuais reais (menores para prÃªmios melhores)
    const premiosReais = [
      { nome: "Skin rara", chance: 5, cor: "#FFD700" },
      { nome: "100 moedas", chance: 15, cor: "#87CEEB" },
      { nome: "Nada ðŸ˜¢", chance: 80, cor: "#FF6347" }
    ];
    
    // Percentuais visuais (para exibiÃ§Ã£o na roleta - mantÃ©m a aparÃªncia igual)
    const premiosVisuais = [
      { nome: "Skin rara", chance: 33.3, cor: "#FFD700" },
      { nome: "100 moedas", chance: 33.3, cor: "#87CEEB" },
      { nome: "Nada ðŸ˜¢", chance: 33.4, cor: "#FF6347" }
    ];

    const canvas = document.getElementById("roleta");
    const ctx = canvas.getContext("2d");
    const radius = canvas.width / 2;
    const girarBtn = document.getElementById("girar-btn");
    const timerDisplay = document.getElementById("timer");
    const vencedoresList = document.getElementById("vencedores-list");

    let angulos = []; // armazenar Ã¢ngulos de cada fatia
    let girando = false;
    let countdown;
    let tempoRestante = 10;
    let ultimosVencedores = [];

    // Desenhar a roleta com os percentuais visuais
    function desenharRoleta() {
      let total = premiosVisuais.reduce((acc, p) => acc + p.chance, 0);
      let anguloInicial = 0;
      angulos = [];

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      premiosVisuais.forEach(p => {
        const fatia = (p.chance / total) * 2 * Math.PI;
        ctx.beginPath();
        ctx.moveTo(radius, radius);
        ctx.arc(radius, radius, radius, anguloInicial, anguloInicial + fatia);
        ctx.fillStyle = p.cor;
        ctx.fill();
        ctx.stroke();

        // Texto
        ctx.save();
        ctx.translate(radius, radius);
        ctx.rotate(anguloInicial + fatia / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#000";
        ctx.font = "bold 16px Arial";
        ctx.fillText(p.nome, radius - 20, 5);
        ctx.restore();

        angulos.push({ premio: p.nome, inicio: anguloInicial, fim: anguloInicial + fatia });
        anguloInicial += fatia;
      });
      
      // Centro da roleta
      ctx.beginPath();
      ctx.arc(radius, radius, radius * 0.1, 0, 2 * Math.PI);
      ctx.fillStyle = "#FFF";
      ctx.fill();
      ctx.stroke();
    }

    desenharRoleta();

    // Sorteio baseado na probabilidade real
    function sortearPremio() {
      const total = premiosReais.reduce((acc, p) => acc + p.chance, 0);
      let r = Math.random() * total;
      let acumulado = 0;
      for (const p of premiosReais) {
        acumulado += p.chance;
        if (r <= acumulado) return p.nome;
      }
    }

    // Atualizar a lista de vencedores
    function atualizarVencedores(nick, premio) {
      ultimosVencedores.unshift({ nick, premio });
      if (ultimosVencedores.length > 10) {
        ultimosVencedores.pop();
      }
      
      vencedoresList.innerHTML = '';
      ultimosVencedores.forEach(vencedor => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${vencedor.nick}</strong> - ${vencedor.premio}`;
        vencedoresList.appendChild(li);
      });
    }

    // Girar a roleta
    function girar() {
      if (girando) return;
      const nick = document.getElementById("nick").value.trim();
      if (!nick) { alert("Digite seu nick!"); return; }

      girando = true;
      girarBtn.disabled = true;
      const premio = sortearPremio();

      // Encontrar Ã¢ngulo alvo baseado no prÃªmio visual correspondente
      const premioVisualIndex = premiosVisuais.findIndex(p => p.nome === premio);
      const alvo = angulos[premioVisualIndex];
      const meio = (alvo.inicio + alvo.fim) / 2;

      // RotaÃ§Ã£o extra para dar mais voltas (10 segundos de animaÃ§Ã£o)
      const voltas = 8 * 2 * Math.PI; // 8 voltas completas
      const anguloFinal = (2 * Math.PI - meio) + voltas;

      let anguloAtual = 0;
      let startTime = null;
      const duration = 10000; // 10 segundos
      
      // Iniciar contagem regressiva
      tempoRestante = 10;
      timerDisplay.textContent = `Tempo restante: ${tempoRestante}s`;
      
      clearInterval(countdown);
      countdown = setInterval(() => {
        tempoRestante--;
        timerDisplay.textContent = `Tempo restante: ${tempoRestante}s`;
        if (tempoRestante <= 0) {
          clearInterval(countdown);
        }
      }, 1000);

      function animar(timestamp) {
        if (!startTime) startTime = timestamp;
        const elapsed = timestamp - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Easing function para desacelerar no final
        const easeOut = function (t) { return 1 - Math.pow(1 - t, 3); };
        const easedProgress = easeOut(progress);
        
        anguloAtual = easedProgress * anguloFinal;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(radius, radius);
        ctx.rotate(anguloAtual);
        ctx.translate(-radius, -radius);
        desenharRoleta();
        ctx.restore();

        if (progress < 1) {
          requestAnimationFrame(animar);
        } else {
          girando = false;
          girarBtn.disabled = false;
          const resultado = `${nick} ganhou: ${premio}`;
          document.getElementById("resultado").innerText = resultado;
          
          // Efeito de confete para prÃªmios
          if (premio !== "Nada ðŸ˜¢") {
            lancarConfetes();
          }
          
          // Atualizar lista de vencedores
          atualizarVencedores(nick, premio);

          // Enviar para Google Sheets
          fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({ nick, premio }).toString()
          }).catch(err => console.error("Erro ao enviar dados:", err));
        }
      }

      requestAnimationFrame(animar);
    }
    
    // Efeito de confete
    function lancarConfetes() {
      const confeteCount = 200;
      const colors = ['#FFD700', '#87CEEB', '#FF6347', '#FFFFFF'];
      
      for (let i = 0; i < confeteCount; i++) {
        const confete = document.createElement('div');
        confete.style.position = 'fixed';
        confete.style.width = '10px';
        confete.style.height = '10px';
        confete.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confete.style.left = Math.random() * window.innerWidth + 'px';
        confete.style.top = '-20px';
        confete.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confete.style.zIndex = '1000';
        document.body.appendChild(confete);
        
        const animation = confete.animate([
          { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
          { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
        ], {
          duration: 1000 + Math.random() * 3000,
          easing: 'cubic-bezier(0.1, 0.8, 0.3, 1)'
        });
        
        animation.onfinish = () => confete.remove();
      }
    }
  </script>
</body>
</html>
